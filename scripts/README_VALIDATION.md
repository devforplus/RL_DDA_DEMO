# 리플레이 검증 도구 사용 가이드

## 개요

리플레이 데이터의 정확성을 검증하는 두 가지 방법을 제공합니다:

1. **데이터 검증 스크립트** (`validate_replay.py`): 빠른 검증, Pyxel 불필요
2. **Pyxel 실행 검증 스크립트** (`validate_replay_pyxel.py`): 실제 게임 실행하며 검증

## 1. 데이터 검증 스크립트 (빠른 검증)

Pyxel 없이 데이터만 비교하여 빠르게 검증합니다.

### 사용법

```bash
python scripts/validate_replay.py <리플레이_JSON_파일>
```

### 예시

```bash
# master.json 검증
python scripts/validate_replay.py models/master.json

# beginner.json 검증
python scripts/validate_replay.py models/beginner.json

# frontend의 파일도 검증 가능
python scripts/validate_replay.py frontend/public/models/master.json
```

### 특징

- ✅ 빠른 실행 (Pyxel 초기화 불필요)
- ✅ 모든 프레임 검증
- ✅ 상세한 오류 보고
- ❌ 실제 게임 로직은 검증하지 않음

## 2. Pyxel 실행 검증 스크립트 (실제 게임 실행)

Pyxel을 사용하여 실제 게임을 실행하면서 검증합니다.

### 사용법

```bash
python scripts/validate_replay_pyxel.py <리플레이_JSON_파일>
```

### 예시

```bash
# master.json 검증
python scripts/validate_replay_pyxel.py models/master.json
```

### 특징

- ✅ 실제 게임 엔진으로 실행
- ✅ 게임 로직까지 검증
- ✅ 시각적으로 확인 가능
- ✅ ESC 키로 일찍 종료 가능
- ⚠️ Pyxel 창이 열림
- ⚠️ 실행 시간이 더 걸림

### 화면 표시

게임 화면 상단에 다음 정보가 표시됩니다:
- `REPLAY VALIDATION`: 검증 모드 표시
- `Frame: X/Y`: 현재 프레임 / 전체 프레임
- `Progress: X.X%`: 진행률
- `Errors: N`: 발견된 오류 수 (있는 경우)
- `COMPLETE!`: 리플레이 완료 시 표시
- `ALL OK!` 또는 `ERRORS: N`: 검증 결과

### 종료 방법

1. **자동 종료**: 리플레이가 끝나면 3초 후 자동 종료
2. **ESC 키**: 언제든지 ESC 키를 눌러 일찍 종료

## 검증 항목

두 스크립트 모두 다음 항목을 검증합니다:

1. **플레이어 위치** (`player_x`, `player_y`)
   - 허용 오차: 1픽셀 (부동소수점 오차 고려)

2. **점수** (`player_score`)
   - 정확히 일치해야 함

3. **생명 수** (`player_lives`)
   - 정확히 일치해야 함

4. **무기** (`current_weapon`)
   - 정확히 일치해야 함

## 검증 결과 해석

### 성공적인 검증

```
============================================================
리플레이 검증 결과
============================================================
총 프레임: 1317
오류 프레임: 0
오류율: 0.00%
총 오류 수: 0

[OK] 오류 없음! 리플레이가 정확하게 재현되었습니다.
============================================================
```

### 오류가 있는 경우

```
============================================================
리플레이 검증 결과
============================================================
총 프레임: 1317
오류 프레임: 5
오류율: 0.38%
총 오류 수: 8

오류 유형:
  - score_mismatch: 3개
  - player_x_mismatch: 2개
  - player_y_mismatch: 3개

처음 10개 오류 상세:
  프레임 100: score_mismatch
    예상: 500, 실제: 400
    차이: -100
  프레임 200: player_x_mismatch
    예상: 128.0, 실제: 130.0
    차이: 2.0
============================================================
```

## 권장 사용 방법

1. **빠른 검증**: `validate_replay.py` 사용
   - CI/CD 파이프라인에서 사용
   - 여러 파일 일괄 검증
   - 개발 중 빠른 확인

2. **정밀 검증**: `validate_replay_pyxel.py` 사용
   - 실제 게임 동작 확인
   - 시각적 검증 필요 시
   - 최종 릴리스 전 검증

## 문제 해결

### 오류가 발생하는 경우

1. **점수 불일치**: 리플레이 모드에서 점수 추가 로직 확인
2. **위치 불일치**: 플레이어 이동 로직 확인
3. **생명 수 불일치**: 게임 오버/리스폰 로직 확인

### Pyxel 창이 열리지 않는 경우

- Pyxel이 제대로 설치되어 있는지 확인: `rye sync`
- 그래픽 드라이버 업데이트 확인
- 다른 Pyxel 프로그램이 실행 중인지 확인




